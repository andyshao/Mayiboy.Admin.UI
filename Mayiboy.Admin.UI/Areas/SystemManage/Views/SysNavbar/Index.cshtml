
@{
    ViewBag.Title = "栏目管理";
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
}
@section head_section{

}
<div class="layui-card layadmin-header">
    <div class="layui-breadcrumb" lay-filter="breadcrumb" style="visibility: visible;">
        <a lay-href="">主页</a><span lay-separator="">/</span>
        <a><cite>组件</cite></a><span lay-separator="">/</span>
        <a><cite>数据表格</cite></a><span lay-separator="">/</span>
        <a><cite>数据表格的重载</cite></a>
    </div>
</div>

<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-header">
                    系统栏目管理
                </div>
                <div class="layui-card-body" style="margin: 0px; padding: 0px;">
                    <div class="test-table-reload-btn" style="display: block;">
                        <div class="layui-btn-container" style="padding: 5px; text-align: right;">
                            <div class="layui-btn-group">
                                <button id="btnadd" class="layui-btn">增加</button>
                            </div>
                        </div>
                    </div>

                    <table id="dttable" lay-filter="table-operate" data-url="@Url.Action("Query", "SysNavbar", new {areas = "SystemManage"})" data-delurl="@Url.Action("Del", "SysNavbar", new {areas = "SystemManage"})"></table>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="editsysnavbar" title="添加系统栏目" style="display: none;" data-url="@Url.Action("Save", "SysNavbar", new {areas = "SystemManage"})">
    <div class="layui-form" style="padding: 20px;" data-url="@Url.Action("Save", "SysNavbar", new {areas = "SystemManage"})">
        <input id="txtid" type="hidden" value="0" />
        <div class="layui-form-item">
            <label class="layui-form-label">名称：</label>
            <div class="layui-input-block">
                <input id="txtname" type="text" name="title" required lay-verify="required" placeholder="名称" style="width: 300px;" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">地址：</label>
            <div class="layui-input-block">
                <input id="txturl" type="text" name="title" placeholder="地址" style="width: 300px;" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">排序：</label>
            <div class="layui-input-block">
                <input id="txtsort" type="number" name="title" value="0" required lay-verify="required" style="width: 200px;" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">备注：</label>
            <div class="layui-input-block">
                <textarea id="txtremark" name="desc" placeholder="请输入内容" class="layui-textarea" style="width: 300px; height: 30px; resize: none"></textarea>
            </div>
        </div>
    </div>
</div>


@section foot_section{
    <script>
        $(function() {
                var editsysnavbarnum;
                var thisPage = {
                    Buttons: {
                        Table: null
                    },
                    Init: function() {
                        thisPage.InitTable();
                        $("#btnadd").click(function() {
                            thisPage.ShowEditPage();
                        });
                    },
                    ShowEditPage: function(data) {
                        if (data == null) {
                            //初始化编辑页
                            $("#txtid").val("0");
                            $("#txtname").val("");
                            $("#txturl").val("");
                            $("#txtsort").val("0");
                            $("#txtremark").val("");
                        } else {
                            //初始化编辑页
                            $("#txtid").val(data.Id);
                            $("#txtname").val(data.Name);
                            $("#txturl").val(data.Url);
                            $("#txtsort").val(data.Sort);
                            $("#txtremark").val(data.Remark);
                        }


                        editsysnavbarnum = layer.open({
                            title: "新增系统栏目",
                            type: 1,
                            area: ['500px', '415px'],
                            offset: '20px',
                            content: $('#editsysnavbar'), //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
                            btn: ["保存", "取消"],
                            btn1: function() {
                                thisPage.SaveSysNavbar();
                            },
                            btn2: function() {
                                // alert("取消");
                            },
                            cancel: function() {
                                // alert("退出");
                            }
                        });
                    },
                    SaveSysNavbar: function() {

                        //验证表单
                        var isb = layer.IsValidation("#editsysnavbar");

                        if (isb == null) {
                            $.ajax({
                                type: "post",
                                url: $("#editsysnavbar").data("url"),
                                data: {
                                    id: $("#txtid").val(),
                                    name: $("#txtname").val(),
                                    url: $("#txturl").val(),
                                    sort: $("#txtsort").val(),
                                    remark: $("#txtremark").val()
                                },
                                success(res) {
                                    if (res.status == 0) {
                                        layer.msg("保存成功");
                                        thisPage.Buttons.Table.reload();
                                        layer.close(editsysnavbarnum);
                                    } else {
                                        layer.msg("保存失败");
                                    }
                                }
                            });
                        }
                    },
                    InitTable: function() {
                        layui.use("table", function() {
                            var table = layui.table;
                            //第一个实例
                            thisPage.Buttons.Table = table.render({
                                elem: '#dttable',
                                url: $("#dttable").data("url"), //数据接口
                                page: true, //开启分页
                                even: true, //各行变色
                                cols: [
                                [
                                { field: 'id', title: '序号', type: "numbers", width: 60 },
                                { field: 'Name', title: '名称', width: 200 },
                                { field: 'Url', title: '地址' },
                                { field: 'Sort', title: '排序', width: 200 },
                                {field:'Remark',title:'备注',width:200},
                                {
                                field: 'CreateTime',
                                title: '创建时间',
                                width: 180,
                                templet: function(row) {
                                    return $.Extend_formatDateTime(row.CreateTime);
                                }
                            },
                            {
                                field: 'look',
                                title: '操作',
                                width: 150,
                                templet: function(row) {
                                    var html = "";
                                    html += '<a href="javascript:;" class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>';
                                    html += '<a href="javascript:;" class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>';
                                    return html;
                                }
                            }
                            ]
                            ],
                            done: function(res, curr, count) {

                            }
                        });

                        //监听工具条
                        table.on('tool(table-operate)', function(obj) {
                            var data = obj.data; //获得当前行数据
                            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                            var tr = obj.tr; //获得当前行 tr 的DOM对象

                            switch (obj.event) {
                            case "edit":
                                thisPage.ShowEditPage(data);
                                break;
                            case "del":
                                layer.confirm('真的删除行吗？', function(index) {
                                    thisPage.Del(data, index);
                                });
                                break;
                            default:
                            }
                        });
                    });
            },
            Del:

        function(row, index) {
            $.ajax({
                type: "get",
                url: $("#dttable").data("delurl"),
                data: { id: row.Id },
                success: function(res) {
                    if (res.status == 0) {
                        thisPage.Buttons.Table.reload();
                        layer.close(index);
                    } else {
                        layer.alert(res.msg);
                    }

                }
            });
        }
        }

        thisPage.Init();
        })
    </script>
}
